<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <link rel="stylesheet" href="/css/zepto.fullpage.css">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/animate.css">
  <title>Dome</title>
</head>
<body>
  <div class="wp">
    <div class="wp-inner" >
      <div class="page page-1">
          <div class="item item-1 js-animate animated" data-animate="">
            <div class="qiuqian">
                <!-- <img src="/img/01/qiuqian.png" alt="" width="50%" class="js-animate animated" data-animate=""> -->
                <input type="text" name="name" id="name" placeholder="输入姓名">
                <button id="next">确认</button>
            </div>
            <div class="miaoshu js-animate animated" data-animate="Up">
                <img src="/img/01/wenzi.png" class="" alt="" width="100%">
            </div>
          </div>
      </div>
      <div class="page page-2" id="sop">
        <div class="item item-2 js-animate animated" data-animate="">
          <div class="marign"></div>
          <div class="qian js-animate animated" data-animate="">
            <img id="drow" src="/img/qian/1.png" alt="">
          </div>
          <div class="erwei js-animate animated" data-animate="">
            <img src="/img/02/erweima.png" width="18%" alt="" class="">
          </div>
          <div class="wenzi js-animate animated" data-animate="">
            <div class="t">这是<span>xxx</span>的新年签</div>
            <div>识别图中二维码获得新年签</div>
            <!-- <img src="/img/02/wenzi.png" alt="" width="70%" class=""> -->
          </div>
          <div class="miaoshu js-animate animated" data-animate="Up">
              <img src="/img/01/wenzi.png" class="" alt="" width="100%">
          </div>
          <div class="bg js-animate animated" data-animate="fadeIn" style="display: none;"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="/js/zepto.min.js"></script>
  <script src="/js/zepto.fullpage.js"></script>
  <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
  <script src="/js/html2canvas.min.js"></script>
  <script src="/js/canvas2image.js"></script>
  <script src="/js/index.js"></script>
  <script>
    $('.wp-inner').fullpage({
      duration: 100,
      dir: 'h',
      change: function (e) {
        // 移除动画属性
        
      },
      afterChange: function (e) {
        // 添加动画属性
        setTimeout(function() {
          $('.page').eq(e.cur).find('.js-animate').each(function() {
            $(this).addClass($(this).data('animate')).show();
          });
        }, 300);
        
        if(e.cur == 1) {
          setTimeout(function(){
            $('.page').eq(e.cur).find('.js-animate').each(function () {
              $(this).removeClass($(this).data('animate'));
            });
            var newCanvas = document.createElement("canvas"); //创建一个canvas节点
            var scale = 4; //定义任意放大倍数 支持小数
            newCanvas.width = $('#sop').width() * scale; //定义canvas 宽度 * 缩放
            newCanvas.height = $('#sop').height() * scale; //定义canvas高度 *缩放
            newCanvas.getContext("2d").scale(scale, scale); //获取context,设置scale
            html2canvas(document.getElementById('sop'), {
              useCORS: true,
              // scale: scale,
              canvas: newCanvas,
              // height: $('#sop').height(),
              // width: $('#sop').width(),
              // dpi: window.devicePixelRatio,
              // onrendered: function(canvas) {
              //   $('.item-2').append(Canvas2Image.convertToJPEG(canvas, canvas.width, canvas.height));
              // }
            }).then(function(canvas) {
              // var context = canvas.getContext('2d');
              // // 【重要】关闭抗锯齿
              // context.mozImageSmoothingEnabled = false;
              // context.webkitImageSmoothingEnabled = false;
              // context.msImageSmoothingEnabled = false;
              // context.imageSmoothingEnabled = false;
              $('.item-2').append(Canvas2Image.convertToBMP(canvas, canvas.width, canvas.height));
              // $('.item-2').append(canvas);
            });
          }, 1000);
          $.fn.fullpage.stop();
        };

      // if(e.cur == 8) $.fn.fullpage.start();
      // // 最后一页不动
      // if(e.cur == 9) $.fn.fullpage.stop();
    }
  });
  $.fn.fullpage.stop();
  </script>
</body>
</html>